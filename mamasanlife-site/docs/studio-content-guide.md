# Sanity Studio コンテンツ編集ガイド

## 1. プレビューを同じ画面で見る方法
投稿を開くと画面上部に `編集` と `プレビュー` の2タブが並びます。右上の「□が2つ重なったアイコン」（Split View）を押すと左右に分割され、編集しながらライブプレビューを確認できます。

1. 記事を選択すると自動的にタブが表示されます。もし見当たらない場合は、右上の「⋯」→ **Open preview**（`Ctrl + Alt + O` / `⌘ + Option + O`）で再表示してください。
2. プレビューパネルの右上にある ↗︎ を押すと別タブで大きく開けます。真っ白な場合は `npm run dev` が起動しているか、Sanity にログイン済みか、`/api/preview` でクッキーが発行されているか確認します。
3. `.env.local` に `NEXT_PUBLIC_SITE_URL=http://localhost:3000` を入れて `npm run dev` を再起動しておくと、URLが `undefined` になる問題を避けられます。本番で確認したいときは本番ドメインに差し替えてください。

## 2. 本文ブロック（＋メニュー）の使い方

### 基本操作
1. 本文エリアで Enter を押すと段落が区切られます。
2. 左端に表示される「＋」をクリックするとブロック一覧が開きます。
3. 画像やボタンなど挿入したいアイテムを選ぶだけでOK（画像を入れたら alt も忘れずに）。

### よく使うカスタムブロック
| ブロック名 | 使いどころ | 入力のコツ |
| --- | --- | --- |
| **吹き出し** | 会話形式の説明や体験談。左右切替で掛け合いも可能。 | 1段落ごとに Enter。アイコンURLは任意。 |
| **表（テーブル）** | 比較表・料金表。 | 「1行目を見出し」にするとヘッダーがグレーになります。 |
| **リンク付き画像バナー** | ブログ村／Appreach など単体バナー。 | `href` と `src` を入れるだけ。 |
| **リンク画像の横並び** | バナーを2〜4個並べたいとき。 | 2個以上が推奨。1個だけなら前ブロックを使用。 |
| **ブログカード** | 既存記事をカード表示。 | URL貼り付けで自動装飾。必要に応じタイトルを上書き。 |
| **色付きボタンリンク** | 本文途中に目立つボタン。 | 「Amazonで見る」など短い文言とリンクを入力。 |
| **もしもEasyLinkカード** | もしもアフィリの「かんたんリンク」。 | 既にJSONが入っているので文言や色だけ調整。 |
| **アフィリエイトHTML** | ASPが発行したHTMLをそのまま入れたいとき。 | JavaScriptは動かない場合があるため慎重に。 |
| **HTML埋め込み** | Googleフォーム等の iframe/スクリプト。 | 信頼できるコードのみ貼り付け。 |

### 小技
- 「/」を入力するとクイックコマンドが開き、`/table` などで高速挿入できます。
- H2 → H3 → 本文の順で構成すると読みやすさが安定します。
- 画像は必ず alt を入れてアクセシビリティとSEOを確保。

## 3. 困ったときのチェックリスト
1. **Missing keys** が出る → `node scripts/fix-sanity-posts.js` を実行すると Portable Text に `_key` が自動付与されます。
2. **Unknown fields** が出る → 旧フィールド（categories/mainImage）が残っているので、同じスクリプトを実行して削除。
3. プレビューが真っ白 → `npm run dev` が動いているか / `.env.local` の `NEXT_PUBLIC_SITE_URL` が設定されているか / Sanityでログインしているか確認。
4. **Validation（赤文字）** → 入力漏れ・形式違いです。フィールドをクリックすると理由が表示されます。  
   - 例: タイトル8文字以上、スラッグは半角英数字＋ハイフン、Hero画像のalt必須、本文3ブロック以上、ターゲットキーワードとワークフローの選択必須など。  
   - すべて解消すると `Publish` が押せる状態になります。

このガイドは `docs/studio-content-guide.md` にあります。必要に応じてスクリーンショットやGIFを貼り足して、チーム内のナレッジベースとして活用してください。
